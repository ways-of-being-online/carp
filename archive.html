<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Action Graphics Network</title>
    <meta name="title" content="Action Graphics Network">
    <meta name="description" content="">

    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:image" content="meta.png">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="">
    <meta property="twitter:description" content="">
    <meta property="twitter:image" content="">

    <link rel="stylesheet" type="text/css" href="visual.css">
  </head>

  <body>
    <div class="picnic-basket">
      <nav>
        <div class="logo"><a href="/">logo</a></div>
        <div class="items">
          <div><a href="/archive.html">Archive</a></div>
          <div><a href="/community.html">Community Guidelines</a></div>
          <div><a href="/resources.html">Resources</a></div>
          <div><a href="/about.html">About</a></div>
          <div><a href="/touch.html">Get in Touch</a></div>
        </div>
      </nav>
      <div class="archive-wrapper">
        <div class="filters">

          <div id="filter-list">
            <h2>Archive</h2>
            <span>Filters:</span><button class="filt active">all</button>
          </div>

          <div id="project-list">

          </div>
        </div>
        <div id="display" class="display">

        </div>
      </div>
    </div>



    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      const filterList = document.getElementById("filter-list");
      const projectList = document.getElementById("project-list");
      const display = document.getElementById("display");

      const displayProjectRow = document.createElement("div");

      const axiosArena = axios.create({
        baseURL: "https://api.are.na/v2/",
      });

      let loading = document.createElement("div");
      loading.className = "loading";
      loading.innerHTML = 'loading...';
      projectList.appendChild(loading);


      axiosArena.defaults.headers.Authorization = 'Bearer ---' ;

      axiosArena.get("channels/all-filters").then(response => {
        if (response.data && response.data.contents.length > 0) {
          createFilterList(response.data.contents);
        }
      });

      axiosArena.get("channels/agn-archive").then(response => {
        if (response.data && response.data.contents.length > 0) {
          createProjectList(response.data.contents);
          projectList.removeChild(loading);
        }
      });

      function createFilterList(data) {
        data.map((fil) => {
          let filterName = document.createElement("button");
          let name = fil.slug;
          name = name.replace(/\b(\w*agn\w*)\b\-/, "");
          filterName.classList.add("filt");
          filterName.addEventListener("click", displayProjects);
          filterName.innerHTML = name;

          filterList.appendChild(filterName);
        })
      }

      function createProjectList(data) {
        if (data) {
          data.map((proj) => {
            let projectName = document.createElement("p");
            let name = proj.title;
            let description = proj.metadata.description;
            name = name.replace(/☁/, "");
            projectName.classList.add("project-name");
            projectName.innerHTML = name;
            projectList.appendChild(projectName);

            axiosArena.get(`channels/${proj.slug}`).then(response => {
              if (response.data && response.data.contents.length > 0) {
                getProjectByRow(response.data.contents, name, description);
              }
            });
          })
        }
      }

      function getProjectByRow(data, name, desc) {
        let projectName = document.createElement("h2");
        let projectDesc = document.createElement("h3");
        let blockWrapper = document.createElement("div");
        blockWrapper.classList.add("block-wrapper");

        projectName.innerHTML = name;
        projectDesc.innerHTML = desc;
        displayProjectRow.appendChild(projectName);
        displayProjectRow.appendChild(projectDesc);


        data.map((proj) => {
          if (proj.title) {
            let projectBlock = document.createElement("div");
            projectBlock.className = "project-block";
            projectBlock.innerHTML = proj.title;
            if (proj.image) {
              let image = document.createElement("img");
              image.className = "image";
              image.src = proj.image.original.url;
              image.alt = proj.title;
              projectBlock.appendChild(image);
            }
            blockWrapper.appendChild(projectBlock)
          }

        })

        displayProjectRow.appendChild(blockWrapper)
        display.appendChild(displayProjectRow);
      }


      function displayProjects() {
        // console.log(this.innerHTML);
      }
    </script>
  </body>
</html>
